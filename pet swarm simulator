--[[
    Script transformado para Rayfield
    Remoção total de emojis e informações desnecessárias
    Anti 404 incluído (remoção do popup de coins)
--]]

-- Carregar Rayfield
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- Serviços
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local LogService = game:GetService("LogService")
local StarterGui = game:GetService("StarterGui")

-- LocalPlayer
local LocalPlayer = Players.LocalPlayer

-- Remotes
local Remotes = ReplicatedStorage:FindFirstChild("Remotes")
if not Remotes then return end

local Events = Remotes:FindFirstChild("Events")
local Functions = Remotes:FindFirstChild("Functions")
if not Events or not Functions then return end

-- Bloqueio total do popup de coins (anti 404)
local function blockCurrencyPopup()
    -- Remove o remote original se existir
    local currencyRemote = Events:FindFirstChild("UpdateCurrency")
    if currencyRemote then
        currencyRemote:Destroy()
    end

    -- Cria um remote falso que não faz nada
    local fakeRemote = Instance.new("RemoteEvent")
    fakeRemote.Name = "UpdateCurrency"
    fakeRemote.Parent = Events
    fakeRemote.OnClientEvent:Connect(function() end)

    -- Remove scripts que geram popups
    local playerScripts = LocalPlayer and LocalPlayer:FindFirstChild("PlayerScripts")
    if playerScripts then
        for _, v in ipairs(playerScripts:GetDescendants()) do
            if v:IsA("LocalScript") and (v.Name == "Ma" or v.Name == "Mi") then
                v:Destroy()
            end
        end
        playerScripts.ChildAdded:Connect(function(child)
            if child:IsA("LocalScript") and (child.Name == "Ma" or child.Name == "Mi") then
                child:Destroy()
            end
        end)
    end

    -- Remove qualquer CurrencyPopUp que aparecer
    local function destroyPopUps(container)
        for _, v in ipairs(container:GetDescendants()) do
            if v.Name == "CurrencyPopUp" then
                pcall(v.Destroy, v)
            end
        end
    end

    -- Conexões para remoção instantânea
    CoreGui.ChildAdded:Connect(function(child)
        if child.Name == "CurrencyPopUp" then
            child:Destroy()
        end
    end)

    if LocalPlayer and LocalPlayer:FindFirstChild("PlayerGui") then
        LocalPlayer.PlayerGui.ChildAdded:Connect(function(child)
            if child.Name == "CurrencyPopUp" then
                child:Destroy()
            end
        end)
    end

    -- Loop de varredura contínua
    task.spawn(function()
        while task.wait(0.5) do
            destroyPopUps(CoreGui)
            local pg = LocalPlayer and LocalPlayer:FindFirstChild("PlayerGui")
            if pg then
                destroyPopUps(pg)
            end
        end
    end)
end

blockCurrencyPopup()

-- Limpa o console a cada 2 segundos
task.spawn(function()
    while task.wait(2) do
        LogService:ClearOutput()
    end
end)

-- Configurações padrão
local config = {
    autoPlant = false,
    plantBurstCount = 9,
    plantBurstDelay = 0.01,
    autoHash = false,
    hashCount = 1,
    hashDelay = 0.0001,
    autoFeedNests = false,
    feedDelay = 0.5,
    farmBosses = false,
    bossDelay = 0.2,
    farmSummer = false,
    summerDelay = 0.001,
    farmFood = false,
    foodDelay = 0.2,
}

-- Dados dos ovos
local eggData = {
    { name = "Summer Egg", zone = "SummerEvent1" },
    { name = "Winter Egg", zone = "WinterEvent1" },
    { name = "Draco Egg", zone = "34" },
    { name = "Crystal Egg", zone = "12.1" },
    { name = "Sphinx Egg", zone = "EleEgg1" },
    { name = "Octopus Egg", zone = "30" },
    { name = "Tiki Egg", zone = "24" },
    { name = "Void Egg", zone = "27" },
    { name = "Desert Egg", zone = "6" },
}

-- Lista de chefes
local bossList = {
    { name = "Naga", zone = "Zone2B1", special = false },
    { name = "Lava Monster", zone = "Zone5B1", special = false },
    { name = "Ghost Pirate", zone = "Zone8B1", special = true, nilBoss = true },
    { name = "Tiki Monster", zone = "Zone10B1", special = false },
    { name = "The Big 100M", zone = "Zone12B3", special = false },
    { name = "The Frozen Ancient", zone = "Zone12B1", special = false },
    { name = "The Ethereal Everia", zone = "Zone12B2", special = false },
    { name = "Hornet Boss", zone = "SummerEventZoneB1", special = true },
    { name = "The Ice Serpent", zone = "WinterEventZoneB1", special = false },
    { name = "Great Sphinx", zone = "ElementEventZoneB1", special = false },
}

-- Estado dos ovos e chefes
local eggsSelected = {}
local bossEnabled = {}
for _, boss in ipairs(bossList) do
    bossEnabled[boss.name] = false
end

-- Cooldown dos chefes
local bossCooldown = {}
for _, boss in ipairs(bossList) do
    bossCooldown[boss.name] = 0
end

-- Cache de zonas
local cacheZones = {}
local function getZone(zoneName)
    if not cacheZones[zoneName] then
        cacheZones[zoneName] = Workspace.Zones:FindFirstChild(zoneName)
    end
    return cacheZones[zoneName]
end

-- Limpa cache a cada 45s
task.spawn(function()
    while task.wait(45) do
        cacheZones = {}
    end
end)

-- Utilitários
local function getPets()
    if not LocalPlayer.Character then return {} end
    local pets = LocalPlayer.Character:FindFirstChild("Pets")
    return pets and pets:GetChildren() or {}
end

local function findNilBoss(name)
    for _, v in pairs(getnilinstances()) do
        if v.ClassName == "Vector3Value" and v.Name == name then
            return v
        end
    end
    return nil
end

-- Remotes usados nas farms
local CombatRF = Functions:FindFirstChild("CombatRF")
local CollectionRF = Functions:FindFirstChild("CollectionRF")
local HatchEggEvent = Events:FindFirstChild("HatchEggEvent")
local PlantEggEvent = Events:FindFirstChild("PlantEggEvent")
local ZonesRF = Functions:FindFirstChild("ZonesRF")
local FeedEggEvent = Events:FindFirstChild("FeedEggEvent")

-- Flags de controle das threads
local threadFlags = {
    plant = false,
    hash = false,
    feed = false,
    boss = false,
    summer = false,
    food = false,
}

-- ========== LOOPS ==========

-- Plantar ovos
local function plantLoop()
    while threadFlags.plant and config.autoPlant do
        for zone, _ in pairs(eggsSelected) do
            for _ = 1, config.plantBurstCount do
                if not threadFlags.plant then break end
                task.spawn(function()
                    pcall(PlantEggEvent.FireServer, PlantEggEvent, zone)
                end)
            end
            if config.plantBurstDelay > 0 then
                task.wait(config.plantBurstDelay)
            end
        end
        task.wait(0.02)
    end
end

-- Chocar ovos (hash)
local function hashLoop()
    while threadFlags.hash and config.autoHash do
        for _ = 1, config.hashCount do
            if not threadFlags.hash then break end
            pcall(HatchEggEvent.FireServer, HatchEggEvent)
            task.wait(config.hashDelay)
        end
        task.wait(config.hashDelay)
    end
end

-- Alimentar ninhos
local function feedLoop()
    while threadFlags.feed and config.autoFeedNests do
        local nests = Workspace:FindFirstChild("Nests")
        if nests and FeedEggEvent then
            for _, nest in ipairs(nests:GetChildren()) do
                if not threadFlags.feed then break end
                task.spawn(function()
                    pcall(FeedEggEvent.FireServer, FeedEggEvent, nest)
                end)
            end
        end
        task.wait(config.feedDelay)
    end
end

-- Farm de chefes
local function bossLoop()
    while threadFlags.boss and config.farmBosses do
        local success = pcall(function()
            local pets = getPets()
            if #pets == 0 then return end
            local now = os.clock()
            local petCycle = 0
            for _, boss in ipairs(bossList) do
                if not threadFlags.boss then break end
                if bossEnabled[boss.name] and now - bossCooldown[boss.name] >= config.bossDelay then
                    if boss.special then
                        pcall(ZonesRF.InvokeServer, ZonesRF, "RequestZoneMap", boss.zone)
                    end
                    local enemy
                    if boss.nilBoss then
                        enemy = findNilBoss(boss.name)
                    else
                        local zoneObj = getZone(boss.zone)
                        if zoneObj and zoneObj:FindFirstChild("Enemies") then
                            enemy = zoneObj.Enemies:FindFirstChild(boss.name)
                        end
                    end
                    if enemy then
                        petCycle = petCycle % #pets + 1
                        task.spawn(function()
                            pcall(CombatRF.InvokeServer, CombatRF, "AttackEnemy", enemy, pets[petCycle])
                        end)
                        bossCooldown[boss.name] = now
                    end
                end
            end
        end)
        task.wait(success and 0.1 or 0.5)
    end
end

-- Farm de verão
local function summerLoop()
    while threadFlags.summer and config.farmSummer do
        local success = pcall(function()
            local zone = getZone("SummerEventZone")
            local pets = getPets()
            if zone and zone:FindFirstChild("Enemies") and #pets > 0 then
                local idx = 1
                for _, enemy in ipairs(zone.Enemies:GetChildren()) do
                    if not threadFlags.summer then break end
                    task.spawn(function()
                        pcall(CombatRF.InvokeServer, CombatRF, "AttackEnemy", enemy, pets[idx])
                    end)
                    idx = idx + 1
                    if idx > #pets then idx = 1 end
                end
            end
        end)
        task.wait(success and config.summerDelay or 0.5)
    end
end

-- Farm de comida
local function foodLoop()
    while threadFlags.food and config.farmFood do
        local success = pcall(function()
            local zone = getZone("Zone12.1")
            local pets = getPets()
            if zone and zone:FindFirstChild("FoodSpawns") and #pets > 0 then
                local idx = 1
                for _, food in ipairs(zone.FoodSpawns:GetChildren()) do
                    if not threadFlags.food then break end
                    task.spawn(function()
                        pcall(CollectionRF.InvokeServer, CollectionRF, "CollectFood", food, pets[idx])
                    end)
                    idx = idx + 1
                    if idx > #pets then idx = 1 end
                end
            end
        end)
        task.wait(success and config.foodDelay or 0.5)
    end
end

-- Gerenciador de threads
local function startLoop(loopName, loopFunction)
    if threadFlags[loopName] then return end
    threadFlags[loopName] = true
    task.spawn(loopFunction)
end

local function stopLoop(loopName)
    threadFlags[loopName] = false
end

-- ========== INTERFACE RAYFIELD ==========

-- Criar janela
local Window = Rayfield:CreateWindow({
    Name = "Maverick Hub",
    LoadingTitle = "Carregando...",
    LoadingSubtitle = "by Maverick",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MaverickHub",
        FileName = "Config"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "Chave",
        Subtitle = "Insira a chave",
        Note = "Nao ha chave",
        FileName = "Key",
        SaveKey = false,
        GrabKeyFromSite = false,
        Key = {""}
    }
})

-- Aba Principal
local MainTab = Window:CreateTab("Principal", "home")
local MainSection = MainTab:CreateSection("Controle")

-- Status
local StatusLabel = MainTab:CreateParagraph({
    Title = "Status",
    Content = "Parado | Anti-popup ativo | Console limpo"
})

-- Botões Iniciar/Parar
MainTab:CreateButton({
    Name = "Iniciar Todas Farms",
    Callback = function()
        config.autoPlant = true
        config.autoHash = true
        config.autoFeedNests = true
        config.farmBosses = true
        config.farmSummer = true
        config.farmFood = true

        if #eggsSelected == 0 then
            Rayfield:Notify({Title = "Aviso", Content = "Nenhum ovo selecionado!", Duration = 3})
        end

        startLoop("plant", plantLoop)
        startLoop("hash", hashLoop)
        startLoop("feed", feedLoop)
        startLoop("boss", bossLoop)
        startLoop("summer", summerLoop)
        startLoop("food", foodLoop)

        StatusLabel:Set({Title = "Status", Content = "Executando | Todas as farms ativas"})
        Rayfield:Notify({Title = "Farm", Content = "Todas as farms iniciadas", Duration = 3})
    end
})

MainTab:CreateButton({
    Name = "Parar Todas Farms",
    Callback = function()
        config.autoPlant = false
        config.autoHash = false
        config.autoFeedNests = false
        config.farmBosses = false
        config.farmSummer = false
        config.farmFood = false

        stopLoop("plant")
        stopLoop("hash")
        stopLoop("feed")
        stopLoop("boss")
        stopLoop("summer")
        stopLoop("food")

        StatusLabel:Set({Title = "Status", Content = "Parado | Anti-popup ativo | Console limpo"})
        Rayfield:Notify({Title = "Farm", Content = "Todas as farms paradas", Duration = 3})
    end
})

MainSection = MainTab:CreateSection("Informacoes")
MainTab:CreateParagraph({
    Title = "Protecoes",
    Content = "Popup de coins: BLOQUEADO\nConsole: Limpo a cada 2s\nCache de zonas: Limpo a cada 45s"
})

-- Aba Ovos
local EggsTab = Window:CreateTab("Ovos", "package")
local EggsSection = EggsTab:CreateSection("Selecao de Ovos")

-- Toggles para cada ovo
for _, egg in ipairs(eggData) do
    EggsTab:CreateToggle({
        Name = egg.name,
        CurrentValue = false,
        Callback = function(Value)
            if Value then
                eggsSelected[egg.zone] = true
            else
                eggsSelected[egg.zone] = nil
            end
        end
    })
end

EggsSection = EggsTab:CreateSection("Configuracoes de Plantio")
EggsTab:CreateSlider({
    Name = "Quantidade por burst",
    Range = {1, 20},
    Increment = 1,
    Suffix = "x",
    CurrentValue = config.plantBurstCount,
    Callback = function(Value)
        config.plantBurstCount = Value
    end
})
EggsTab:CreateSlider({
    Name = "Delay entre bursts (s)",
    Range = {0, 0.5},
    Increment = 0.01,
    Suffix = "s",
    CurrentValue = config.plantBurstDelay,
    Callback = function(Value)
        config.plantBurstDelay = Value
    end
})

-- Aba Chefes
local BossesTab = Window:CreateTab("Chefes", "shield")
local BossesSection = BossesTab:CreateSection("Selecao de Chefes")

-- Toggle mestre para farm de chefes
BossesTab:CreateToggle({
    Name = "Farmar Chefes",
    CurrentValue = false,
    Callback = function(Value)
        config.farmBosses = Value
        if Value then
            startLoop("boss", bossLoop)
        else
            stopLoop("boss")
        end
    end
})

BossesSection = BossesTab:CreateSection("Chefes Disponiveis")
for _, boss in ipairs(bossList) do
    BossesTab:CreateToggle({
        Name = boss.name,
        CurrentValue = false,
        Callback = function(Value)
            bossEnabled[boss.name] = Value
        end
    })
end

BossesSection = BossesTab:CreateSection("Configuracoes")
BossesTab:CreateSlider({
    Name = "Delay entre ataques (s)",
    Range = {0.1, 1},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = config.bossDelay,
    Callback = function(Value)
        config.bossDelay = Value
    end
})

-- Aba Farms
local FarmsTab = Window:CreateTab("Farms", "zap")
local FarmsSection = FarmsTab:CreateSection("Auto Hash")

FarmsTab:CreateToggle({
    Name = "Chocar Ovos (Hash)",
    CurrentValue = false,
    Callback = function(Value)
        config.autoHash = Value
        if Value then
            startLoop("hash", hashLoop)
        else
            stopLoop("hash")
        end
    end
})
FarmsTab:CreateSlider({
    Name = "Quantidade por ciclo",
    Range = {1, 10},
    Increment = 1,
    Suffix = "x",
    CurrentValue = config.hashCount,
    Callback = function(Value)
        config.hashCount = Value
    end
})
FarmsTab:CreateSlider({
    Name = "Delay entre acoes (s)",
    Range = {0.0001, 0.01},
    Increment = 0.0001,
    Suffix = "s",
    CurrentValue = config.hashDelay,
    Callback = function(Value)
        config.hashDelay = Value
    end
})

FarmsSection = FarmsTab:CreateSection("Auto Alimentar Ninhos")
FarmsTab:CreateToggle({
    Name = "Alimentar Ninhos",
    CurrentValue = false,
    Callback = function(Value)
        config.autoFeedNests = Value
        if Value then
            startLoop("feed", feedLoop)
        else
            stopLoop("feed")
        end
    end
})
FarmsTab:CreateSlider({
    Name = "Delay entre ciclos (s)",
    Range = {0.1, 2},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = config.feedDelay,
    Callback = function(Value)
        config.feedDelay = Value
    end
})

FarmsSection = FarmsTab:CreateSection("Farm de Verao")
FarmsTab:CreateToggle({
    Name = "Farmar Evento Verao",
    CurrentValue = false,
    Callback = function(Value)
        config.farmSummer = Value
        if Value then
            startLoop("summer", summerLoop)
        else
            stopLoop("summer")
        end
    end
})
FarmsTab:CreateSlider({
    Name = "Delay entre ataques (s)",
    Range = {0.001, 0.1},
    Increment = 0.001,
    Suffix = "s",
    CurrentValue = config.summerDelay,
    Callback = function(Value)
        config.summerDelay = Value
    end
})

FarmsSection = FarmsTab:CreateSection("Farm de Comida")
FarmsTab:CreateToggle({
    Name = "Coletar Comida",
    CurrentValue = false,
    Callback = function(Value)
        config.farmFood = Value
        if Value then
            startLoop("food", foodLoop)
        else
            stopLoop("food")
        end
    end
})
FarmsTab:CreateSlider({
    Name = "Delay entre coletas (s)",
    Range = {0.1, 1},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = config.foodDelay,
    Callback = function(Value)
        config.foodDelay = Value
    end
})

-- Inicializar notificação de carregamento
Rayfield:Notify({
    Title = "Carregado",
    Content = "Maverick Hub carregado com sucesso!",
    Duration = 3
})
