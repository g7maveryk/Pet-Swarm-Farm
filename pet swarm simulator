local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

local CombatRemote = ReplicatedStorage.Remotes.Functions.CombatRF
local CollectionRemote = ReplicatedStorage.Remotes.Functions.CollectionRF
local HatchRemote = ReplicatedStorage.Remotes.Events.HatchEggEvent
local PlantRemote = ReplicatedStorage.Remotes.Events.PlantEggEvent
local ZonesRemote = ReplicatedStorage.Remotes.Functions.ZonesRF
local FeedRemote = ReplicatedStorage.Remotes.Events.FeedEggEvent

-- Estado global
local active = false
local cacheZones = {}
local eggsSelected = { "SummerEvent1" }
local bossEnabled = {}
local npcEnabled = {}
local threads = {}

-- Configurações (eggs no máximo, bosses mais lentos para evitar lag)
local config = {
    autoPlant = true,
    plantBurstCount = 20,
    plantBurstDelay = 0.01,
    autoHash = true,
    hashCount = 5,
    hashDelay = 0.0001,
    autoFeedNests = false,
    feedDelay = 0.0001,
    farmBosses = true,
    bossDelay = 1.0,          -- aumentado para 1s (menos chamadas)
    farmSummer = true,
    summerDelay = 0.5,
    farmFood = true,
    foodDelay = 0.5,
    farmNPCs = false,
    npcDelay = 0.5,
}

-- Dados dos ovos
local eggData = {
    { name = "Summer Egg", zone = "SummerEvent1" },
    { name = "Winter Egg", zone = "WinterEvent1" },
    { name = "Draco Egg", zone = "34" },
    { name = "Crystal Egg", zone = "12.1" },
    { name = "Sphinx Egg", zone = "EleEgg1" },
    { name = "Octopus Egg", zone = "30" },
    { name = "Tiki Egg", zone = "24" },
    { name = "Void Egg", zone = "27" },
    { name = "Desert Egg", zone = "6" },
}

-- Lista de bosses
local bossList = {
    { name = "Naga", zone = "Zone2B1", special = false },
    { name = "Lava Monster", zone = "Zone5B1", special = false },
    { name = "Ghost Pirate", zone = "Zone8B1", special = true, nilBoss = true },
    { name = "Tiki Monster", zone = "Zone10B1", special = false },
    { name = "The Big 100M", zone = "Zone12B3", special = false },
    { name = "The Frozen Ancient", zone = "Zone12B1", special = false },
    { name = "The Ethereal Everia", zone = "Zone12B2", special = false },
    { name = "Hornet Boss", zone = "SummerEventZoneB1", special = true },
    { name = "The Ice Serpent", zone = "WinterEventZoneB1", special = false },
    { name = "Great Sphinx", zone = "ElementEventZoneB1", special = false },
}
for _, v in ipairs(bossList) do bossEnabled[v.name] = true end

-- Cooldown por boss
local bossCooldown = {}
for _, v in ipairs(bossList) do bossCooldown[v.name] = 0 end

-- Dados dos NPCs
local npcZones = {
    ["Zone 1"] = { "Evil Shroom", "Evil Foot", "Deermon" },
    ["Zone 2"] = { "Creepy Cat", "Enchanted Cobra", "Cursed Mummy" },
    ["Zone 3"] = { "Wicked Wolf", "Evil Frozen Yeti", "Dark Spike" },
    ["Zone 4"] = { "Creepy Slime", "Deadly Elephant", "Evil Ogre" },
    ["Zone 5"] = { "Dark Cloud", "Enchanted Macaw", "Crazy Unicorn" },
    ["Zone 6"] = { "Raging Lion", "Mad Golum", "Forbidden Dragon" },
    ["Zone 7"] = { "Dark Griffin", "Evil Minotaur", "Cursed Medusa" },
    ["Zone 8"] = { "Evil Starfish", "Angry Crab", "Deadly Octopus" },
    ["Zone 9"] = { "Vile Bat", "Menacing Sting", "Dark Planet" },
    ["Zone 10"] = { "Mad Penguin", "Cursed Moai", "Terror Tree" },
    ["Zone 11"] = { "Rotten Bush", "Deadly Beetle", "Dark Knight" },
    ["Zone 12"] = { "Draco's Guard" },
}
for zone, npcs in pairs(npcZones) do
    npcEnabled[zone] = npcEnabled[zone] or {}
    for _, npc in ipairs(npcs) do
        npcEnabled[zone][npc] = true
    end
end

-- Funções auxiliares
local function getZone(zoneName)
    if not cacheZones[zoneName] then
        cacheZones[zoneName] = Workspace.Zones:FindFirstChild(zoneName)
    end
    return cacheZones[zoneName]
end

local function getPets()
    if not LocalPlayer.Character then return {} end
    local pets = LocalPlayer.Character:FindFirstChild("Pets")
    return pets and pets:GetChildren() or {}
end

local function findNilBoss(name)
    for _, v in pairs(getnilinstances()) do
        if v.ClassName == "Vector3Value" and v.Name == name then
            return v
        end
    end
    return nil
end

-- Limpeza de cache
task.spawn(function() while task.wait(300) do cacheZones = {} end end)

-- Loops
local function PlantLoop()
    while threads.plant and active and config.autoPlant do
        if #eggsSelected > 0 then
            for _, zone in ipairs(eggsSelected) do
                for _ = 1, config.plantBurstCount do
                    if not active then break end
                    pcall(PlantRemote.FireServer, PlantRemote, zone)
                end
                task.wait(config.plantBurstDelay)
            end
        end
        task.wait(0.01)
    end
end

local function HashLoop()
    while threads.hash and active and config.autoHash do
        for _ = 1, config.hashCount do
            if not active then break end
            pcall(HatchRemote.FireServer, HatchRemote)
            task.wait(config.hashDelay)
        end
        task.wait(config.hashDelay)
    end
end

local function FeedLoop()
    while threads.feed and active and config.autoFeedNests do
        local nests = Workspace:FindFirstChild("Nests")
        if nests then
            for _, nest in ipairs(nests:GetChildren()) do
                if not active then break end
                pcall(FeedRemote.FireServer, FeedRemote, nest)
            end
        end
        task.wait(config.feedDelay)
    end
end

-- Loop de Bosses OTIMIZADO (delay maior para não lagar)
local function BossLoop()
    while threads.boss and active and config.farmBosses do
        local pets = getPets()
        if #pets > 0 then
            local now = os.clock()
            local petCycle = 0
            for _, boss in ipairs(bossList) do
                if not active then break end
                if bossEnabled[boss.name] and now - bossCooldown[boss.name] >= config.bossDelay then
                    if boss.special then
                        pcall(ZonesRemote.InvokeServer, ZonesRemote, "RequestZoneMap", boss.zone)
                    end
                    local enemy
                    if boss.nilBoss then
                        enemy = findNilBoss(boss.name)
                    else
                        local zoneObj = getZone(boss.zone)
                        enemy = zoneObj and zoneObj:FindFirstChild("Enemies") and zoneObj.Enemies:FindFirstChild(boss.name)
                    end
                    if enemy then
                        petCycle = petCycle % #pets + 1
                        pcall(CombatRemote.InvokeServer, CombatRemote, "AttackEnemy", enemy, pets[petCycle])
                        bossCooldown[boss.name] = now
                    end
                end
            end
        end
        task.wait(0.3) -- aumentado de 0.1 para 0.3s (menos verificações)
    end
end

local function SummerLoop()
    while threads.summer and active and config.farmSummer do
        local zone = getZone("SummerEventZone")
        local pets = getPets()
        if zone and zone:FindFirstChild("Enemies") and #pets > 0 then
            local idx = 1
            for _, enemy in ipairs(zone.Enemies:GetChildren()) do
                if not active then break end
                pcall(CombatRemote.InvokeServer, CombatRemote, "AttackEnemy", enemy, pets[idx])
                idx = idx % #pets + 1
            end
        end
        task.wait(config.summerDelay)
    end
end

local function FoodLoop()
    while threads.food and active and config.farmFood do
        local zone = getZone("Zone12.1")
        local pets = getPets()
        if zone and zone:FindFirstChild("FoodSpawns") and #pets > 0 then
            local idx = 1
            for _, food in ipairs(zone.FoodSpawns:GetChildren()) do
                if not active then break end
                pcall(CollectionRemote.InvokeServer, CollectionRemote, "CollectFood", food, pets[idx])
                idx = idx % #pets + 1
            end
        end
        task.wait(config.foodDelay)
    end
end

local function NPCLoop()
    while threads.npc and active and config.farmNPCs do
        local pets = getPets()
        if #pets > 0 then
            local idx = 1
            for zoneName, npcs in pairs(npcEnabled) do
                if not active then break end
                local zoneNum = zoneName:match("%d+")
                local zoneObj = getZone("Zone" .. zoneNum)
                if zoneObj and zoneObj:FindFirstChild("Enemies") then
                    for npcName, enabled in pairs(npcs) do
                        if enabled then
                            local enemy = zoneObj.Enemies:FindFirstChild(npcName)
                            if enemy then
                                pcall(CombatRemote.InvokeServer, CombatRemote, "AttackEnemy", enemy, pets[idx])
                                idx = idx % #pets + 1
                            end
                        end
                    end
                end
            end
        end
        task.wait(config.npcDelay)
    end
end

-- Gerenciamento de threads
local function startThreads()
    threads = { plant = true, hash = true, feed = true, boss = true, summer = true, food = true, npc = true }
    if config.autoPlant then task.spawn(PlantLoop) end
    if config.autoHash then task.spawn(HashLoop) end
    if config.autoFeedNests then task.spawn(FeedLoop) end
    if config.farmBosses then task.spawn(BossLoop) end
    if config.farmSummer then task.spawn(SummerLoop) end
    if config.farmFood then task.spawn(FoodLoop) end
    if config.farmNPCs then task.spawn(NPCLoop) end
end

local function stopThreads()
    threads = {}
end

local function start()
    if active then return end
    active = true
    startThreads()
end

local function stop()
    active = false
    stopThreads()
end

-- Interface
local win = Rayfield:CreateWindow({
    Name = "Maverick Hub",
    LoadingTitle = "Carregando...",
    LoadingSubtitle = "",
    ConfigurationSaving = { Enabled = true, FolderName = "MaverickHub", FileName = "Config" },
    Theme = "Dark"
})

local mainTab = win:CreateTab("Main")
local eggTab = win:CreateTab("Eggs")
local bossTab = win:CreateTab("Bosses")
local npcTab = win:CreateTab("NPCs")
local otherTab = win:CreateTab("Farms")

-- Main
mainTab:CreateSection("Controle")
mainTab:CreateButton({ Name = "Iniciar", Callback = start })
mainTab:CreateButton({ Name = "Parar", Callback = stop })

mainTab:CreateSection("Status")
local st1 = mainTab:CreateLabel("Status: Parado")
local st2 = mainTab:CreateLabel("Bosses: OFF")
local st3 = mainTab:CreateLabel("Summer: OFF")
local st4 = mainTab:CreateLabel("Food: OFF")
local st5 = mainTab:CreateLabel("Eggs: OFF")
local st6 = mainTab:CreateLabel("Nests: OFF")
local st7 = mainTab:CreateLabel("NPCs: OFF")

task.spawn(function()
    while true do
        task.wait(0.5)
        if active then
            st1:Set("Status: Ativo")
            st2:Set("Bosses: " .. (config.farmBosses and "ON" or "OFF"))
            st3:Set("Summer: " .. (config.farmSummer and "ON" or "OFF"))
            st4:Set("Food: " .. (config.farmFood and "ON" or "OFF"))
            st5:Set("Eggs: " .. (config.autoPlant and "ON" or "OFF"))
            st6:Set("Nests: " .. (config.autoFeedNests and "ON" or "OFF"))
            st7:Set("NPCs: " .. (config.farmNPCs and "ON" or "OFF"))
        else
            st1:Set("Status: Parado")
            st2:Set("Bosses: OFF")
            st3:Set("Summer: OFF")
            st4:Set("Food: OFF")
            st5:Set("Eggs: OFF")
            st6:Set("Nests: OFF")
            st7:Set("NPCs: OFF")
        end
    end
end)

-- Aba Eggs (com toggle mestre)
eggTab:CreateSection("Controle de Eggs")
local eggMaster = eggTab:CreateToggle({
    Name = "Ativar Farm de Eggs",
    CurrentValue = config.autoPlant,
    Callback = function(v)
        config.autoPlant = v
        config.autoHash = v
        config.autoFeedNests = v and config.autoFeedNests
    end
})

eggTab:CreateSection("Selecione os ovos")
for _, egg in ipairs(eggData) do
    eggTab:CreateToggle({
        Name = egg.name,
        CurrentValue = (egg.zone == "SummerEvent1"),
        Callback = function(val)
            if val then
                if not table.find(eggsSelected, egg.zone) then
                    table.insert(eggsSelected, egg.zone)
                end
            else
                local idx = table.find(eggsSelected, egg.zone)
                if idx then table.remove(eggsSelected, idx) end
            end
        end,
    })
end

eggTab:CreateSection("Auto Hash (ultra rápido)")
eggTab:CreateToggle({ Name = "Ativar Hash", CurrentValue = config.autoHash, Callback = function(v) config.autoHash = v end })
eggTab:CreateSlider({ Name = "Quantidade", Range = {1, 10}, Increment = 1, Suffix = "x", CurrentValue = config.hashCount, Callback = function(v) config.hashCount = v end })
eggTab:CreateSlider({ Name = "Delay (s)", Range = {0.0001, 0.001}, Increment = 0.0001, Suffix = "s", CurrentValue = config.hashDelay, Callback = function(v) config.hashDelay = v end })

eggTab:CreateSection("Auto Plant (burst máximo)")
eggTab:CreateToggle({ Name = "Ativar Plant", CurrentValue = config.autoPlant, Callback = function(v) config.autoPlant = v end })
eggTab:CreateSlider({ Name = "Ovos por burst", Range = {10, 50}, Increment = 5, Suffix = "x", CurrentValue = config.plantBurstCount, Callback = function(v) config.plantBurstCount = v end })
eggTab:CreateSlider({ Name = "Delay entre bursts (s)", Range = {0.01, 0.1}, Increment = 0.01, Suffix = "s", CurrentValue = config.plantBurstDelay, Callback = function(v) config.plantBurstDelay = v end })

eggTab:CreateSection("Auto Nests (ultra rápido)")
eggTab:CreateToggle({ Name = "Ativar Nests", CurrentValue = config.autoFeedNests, Callback = function(v) config.autoFeedNests = v end })
eggTab:CreateSlider({ Name = "Delay (s)", Range = {0.0001, 0.01}, Increment = 0.0001, Suffix = "s", CurrentValue = config.feedDelay, Callback = function(v) config.feedDelay = v end })

-- Aba Bosses (com toggle mestre)
bossTab:CreateSection("Controle de Bosses")
local bossMaster = bossTab:CreateToggle({
    Name = "Ativar Farm de Bosses",
    CurrentValue = config.farmBosses,
    Callback = function(v) config.farmBosses = v end
})

bossTab:CreateSection("Selecione os Bosses")
for _, boss in ipairs(bossList) do
    bossTab:CreateToggle({
        Name = boss.name,
        CurrentValue = bossEnabled[boss.name],
        Callback = function(v) bossEnabled[boss.name] = v end,
    })
end
bossTab:CreateSlider({ Name = "Cooldown (s)", Range = {0.5, 2}, Increment = 0.1, Suffix = "s", CurrentValue = config.bossDelay, Callback = function(v) config.bossDelay = v end })

-- Aba NPCs (com toggle mestre)
npcTab:CreateSection("Controle de NPCs")
local npcMaster = npcTab:CreateToggle({
    Name = "Ativar Farm de NPCs",
    CurrentValue = config.farmNPCs,
    Callback = function(v) config.farmNPCs = v end
})

npcTab:CreateSection("Selecione os NPCs")
for zoneName, npcs in pairs(npcZones) do
    npcTab:CreateSection(zoneName)
    for _, npcName in ipairs(npcs) do
        npcTab:CreateToggle({
            Name = npcName,
            CurrentValue = npcEnabled[zoneName] and npcEnabled[zoneName][npcName] or false,
            Callback = function(v)
                npcEnabled[zoneName] = npcEnabled[zoneName] or {}
                npcEnabled[zoneName][npcName] = v
            end,
        })
    end
end
npcTab:CreateSlider({ Name = "Cooldown (s)", Range = {0.5, 2}, Increment = 0.1, Suffix = "s", CurrentValue = config.npcDelay, Callback = function(v) config.npcDelay = v end })

-- Aba Farms (Summer e Food) com toggles mestres
otherTab:CreateSection("Summer Event")
local summerMaster = otherTab:CreateToggle({
    Name = "Ativar Summer Farm",
    CurrentValue = config.farmSummer,
    Callback = function(v) config.farmSummer = v end
})
otherTab:CreateSlider({ Name = "Delay (s)", Range = {0.3, 1}, Increment = 0.1, Suffix = "s", CurrentValue = config.summerDelay, Callback = function(v) config.summerDelay = v end })

otherTab:CreateSection("Food Farm")
local foodMaster = otherTab:CreateToggle({
    Name = "Ativar Food Farm",
    CurrentValue = config.farmFood,
    Callback = function(v) config.farmFood = v end
})
otherTab:CreateSlider({ Name = "Delay (s)", Range = {0.3, 1}, Increment = 0.1, Suffix = "s", CurrentValue = config.foodDelay, Callback = function(v) config.foodDelay = v end })
