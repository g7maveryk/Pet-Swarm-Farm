--[[
    MAVERICK HUB - OTIMIZADO
    - Anti popup de coins (404 bloqueado)
    - FPS Boost extremo (remove gráficos, sombras, partículas)
    - Farms otimizadas (menos threads, mais leve)
    - Interface Rayfield limpa e rápida
--]]

-- Carregar Rayfield
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- Serviços
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local LogService = game:GetService("LogService")
local StarterGui = game:GetService("StarterGui")

-- LocalPlayer
local LocalPlayer = Players.LocalPlayer

-- ========== BLOQUEIO POPUP DE COINS (ANTI 404) ==========
local function blockCurrencyPopup()
    local Events = ReplicatedStorage:FindFirstChild("Remotes") and ReplicatedStorage.Remotes:FindFirstChild("Events")
    if not Events then return end

    -- Remove remote original e cria um fake
    local currencyRemote = Events:FindFirstChild("UpdateCurrency")
    if currencyRemote then
        currencyRemote:Destroy()
    end
    local fakeRemote = Instance.new("RemoteEvent")
    fakeRemote.Name = "UpdateCurrency"
    fakeRemote.Parent = Events
    fakeRemote.OnClientEvent:Connect(function() end)

    -- Remove scripts que geram popup
    local playerScripts = LocalPlayer and LocalPlayer:FindFirstChild("PlayerScripts")
    if playerScripts then
        for _, v in ipairs(playerScripts:GetDescendants()) do
            if v:IsA("LocalScript") and (v.Name == "Ma" or v.Name == "Mi") then
                v:Destroy()
            end
        end
        playerScripts.ChildAdded:Connect(function(child)
            if child:IsA("LocalScript") and (child.Name == "Ma" or child.Name == "Mi") then
                child:Destroy()
            end
        end)
    end

    -- Remove qualquer CurrencyPopUp que aparecer
    local function killPopUps(container)
        for _, v in ipairs(container:GetDescendants()) do
            if v.Name == "CurrencyPopUp" then
                pcall(v.Destroy, v)
            end
        end
    end

    CoreGui.ChildAdded:Connect(function(child)
        if child.Name == "CurrencyPopUp" then
            child:Destroy()
        end
    end)

    if LocalPlayer and LocalPlayer:FindFirstChild("PlayerGui") then
        LocalPlayer.PlayerGui.ChildAdded:Connect(function(child)
            if child.Name == "CurrencyPopUp" then
                child:Destroy()
            end
        end)
    end

    task.spawn(function()
        while task.wait(0.5) do
            killPopUps(CoreGui)
            local pg = LocalPlayer and LocalPlayer:FindFirstChild("PlayerGui")
            if pg then killPopUps(pg) end
        end
    end)
end

blockCurrencyPopup()

-- ========== FPS BOOST (MÁXIMA OTIMIZAÇÃO) ==========
local fpsBoostActive = false
local originalSettings = {} -- para restaurar (opcional)

local function applyFPSBoost(enable)
    if enable then
        -- Qualidade gráfica mínima
        settings().Rendering.QualityLevel = 1

        -- Desabilitar sombras globais
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 9e9
        Lighting.Brightness = 2

        -- Remover decalques e partículas do Workspace (recursivo, só uma vez)
        if not fpsBoostActive then
            local function removeGraphics(instance)
                if instance:IsA("Decal") or instance:IsA("Texture") or instance:IsA("ParticleEmitter") or instance:IsA("Trail") or instance:IsA("Smoke") or instance:IsA("Fire") or instance:IsA("Sparkles") then
                    pcall(instance.Destroy, instance)
                elseif instance:IsA("BasePart") and instance.Material == Enum.Material.ForceField then
                    instance.Material = Enum.Material.Plastic
                end
            end

            for _, v in ipairs(Workspace:GetDescendants()) do
                removeGraphics(v)
            end

            Workspace.DescendantAdded:Connect(removeGraphics)
        end

        -- Otimizar renderização
        RunService:Set3dRenderingEnabled(true) -- não desabilitar, só reduzir
        Workspace.DescendantAdded:Connect(function(child)
            if child:IsA("BasePart") and not child:IsA("Terrain") then
                child.Material = Enum.Material.Plastic
                child.Reflectance = 0
            end
        end)

        fpsBoostActive = true
        Rayfield:Notify({Title = "FPS Boost", Content = "Gráficos ultra reduzidos", Duration = 2})
    else
        -- Restaurar configurações padrão (opcional)
        settings().Rendering.QualityLevel = 4
        Lighting.GlobalShadows = true
        Lighting.FogEnd = 100000
        fpsBoostActive = false
        Rayfield:Notify({Title = "FPS Boost", Content = "Gráficos normais restaurados", Duration = 2})
    end
end

-- Aplica boost imediatamente ao carregar (pode ser desativado depois)
applyFPSBoost(true)

-- Limpa o console periodicamente (leve)
task.spawn(function()
    while task.wait(5) do
        LogService:ClearOutput()
    end
end)

-- ========== CONFIGURAÇÕES DAS FARMS ==========
local config = {
    autoPlant = false,
    plantBurstCount = 9,
    plantBurstDelay = 0.01,
    autoHash = false,
    hashCount = 1,
    hashDelay = 0.0001,
    autoFeedNests = false,
    feedDelay = 0.5,
    farmBosses = false,
    bossDelay = 0.2,
    farmSummer = false,
    summerDelay = 0.001,
    farmFood = false,
    foodDelay = 0.2,
}

-- Dados
local eggData = {
    { name = "Summer Egg", zone = "SummerEvent1" },
    { name = "Winter Egg", zone = "WinterEvent1" },
    { name = "Draco Egg", zone = "34" },
    { name = "Crystal Egg", zone = "12.1" },
    { name = "Sphinx Egg", zone = "EleEgg1" },
    { name = "Octopus Egg", zone = "30" },
    { name = "Tiki Egg", zone = "24" },
    { name = "Void Egg", zone = "27" },
    { name = "Desert Egg", zone = "6" },
}

local bossList = {
    { name = "Naga", zone = "Zone2B1", special = false },
    { name = "Lava Monster", zone = "Zone5B1", special = false },
    { name = "Ghost Pirate", zone = "Zone8B1", special = true, nilBoss = true },
    { name = "Tiki Monster", zone = "Zone10B1", special = false },
    { name = "The Big 100M", zone = "Zone12B3", special = false },
    { name = "The Frozen Ancient", zone = "Zone12B1", special = false },
    { name = "The Ethereal Everia", zone = "Zone12B2", special = false },
    { name = "Hornet Boss", zone = "SummerEventZoneB1", special = true },
    { name = "The Ice Serpent", zone = "WinterEventZoneB1", special = false },
    { name = "Great Sphinx", zone = "ElementEventZoneB1", special = false },
}

local eggsSelected = {}
local bossEnabled = {}
for _, boss in ipairs(bossList) do bossEnabled[boss.name] = false end
local bossCooldown = {}
for _, boss in ipairs(bossList) do bossCooldown[boss.name] = 0 end

-- Cache de zonas
local cacheZones = {}
local function getZone(zoneName)
    if not cacheZones[zoneName] then
        cacheZones[zoneName] = Workspace.Zones:FindFirstChild(zoneName)
    end
    return cacheZones[zoneName]
end
task.spawn(function() while task.wait(45) do cacheZones = {} end end)

-- Utilitários
local function getPets()
    return LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Pets") and LocalPlayer.Character.Pets:GetChildren() or {}
end

local function findNilBoss(name)
    for _, v in pairs(getnilinstances()) do
        if v.ClassName == "Vector3Value" and v.Name == name then return v end
    end
end

-- Remotes
local Remotes = ReplicatedStorage:FindFirstChild("Remotes")
local Events, Functions
if Remotes then
    Events = Remotes:FindFirstChild("Events")
    Functions = Remotes:FindFirstChild("Functions")
end
local CombatRF = Functions and Functions:FindFirstChild("CombatRF")
local CollectionRF = Functions and Functions:FindFirstChild("CollectionRF")
local HatchEggEvent = Events and Events:FindFirstChild("HatchEggEvent")
local PlantEggEvent = Events and Events:FindFirstChild("PlantEggEvent")
local ZonesRF = Functions and Functions:FindFirstChild("ZonesRF")
local FeedEggEvent = Events and Events:FindFirstChild("FeedEggEvent")

-- Controle de execução (threads)
local activeLoops = {
    plant = false,
    hash = false,
    feed = false,
    boss = false,
    summer = false,
    food = false,
}

-- ========== LOOPS OTIMIZADOS (SEM CRIAÇÃO EXCESSIVA DE THREADS) ==========
local function plantLoop()
    while activeLoops.plant and config.autoPlant do
        for zone, _ in pairs(eggsSelected) do
            for _ = 1, config.plantBurstCount do
                if not activeLoops.plant then break end
                PlantEggEvent:FireServer(zone)
            end
            if config.plantBurstDelay > 0 then task.wait(config.plantBurstDelay) end
        end
        task.wait(0.02)
    end
end

local function hashLoop()
    while activeLoops.hash and config.autoHash do
        for _ = 1, config.hashCount do
            if not activeLoops.hash then break end
            HatchEggEvent:FireServer()
            task.wait(config.hashDelay)
        end
        task.wait(config.hashDelay)
    end
end

local function feedLoop()
    while activeLoops.feed and config.autoFeedNests do
        local nests = Workspace:FindFirstChild("Nests")
        if nests and FeedEggEvent then
            for _, nest in ipairs(nests:GetChildren()) do
                if not activeLoops.feed then break end
                FeedEggEvent:FireServer(nest)
            end
        end
        task.wait(config.feedDelay)
    end
end

local function bossLoop()
    while activeLoops.boss and config.farmBosses do
        local pets = getPets()
        if #pets > 0 then
            local now = os.clock()
            local petCycle = 0
            for _, boss in ipairs(bossList) do
                if not activeLoops.boss then break end
                if bossEnabled[boss.name] and now - bossCooldown[boss.name] >= config.bossDelay then
                    if boss.special then
                        pcall(ZonesRF.InvokeServer, ZonesRF, "RequestZoneMap", boss.zone)
                    end
                    local enemy
                    if boss.nilBoss then
                        enemy = findNilBoss(boss.name)
                    else
                        local zoneObj = getZone(boss.zone)
                        enemy = zoneObj and zoneObj:FindFirstChild("Enemies") and zoneObj.Enemies:FindFirstChild(boss.name)
                    end
                    if enemy then
                        petCycle = petCycle % #pets + 1
                        CombatRF:InvokeServer("AttackEnemy", enemy, pets[petCycle])
                        bossCooldown[boss.name] = now
                    end
                end
            end
        end
        task.wait(0.1)
    end
end

local function summerLoop()
    while activeLoops.summer and config.farmSummer do
        local zone = getZone("SummerEventZone")
        local pets = getPets()
        if zone and zone:FindFirstChild("Enemies") and #pets > 0 then
            local idx = 1
            for _, enemy in ipairs(zone.Enemies:GetChildren()) do
                if not activeLoops.summer then break end
                CombatRF:InvokeServer("AttackEnemy", enemy, pets[idx])
                idx = idx % #pets + 1
            end
        end
        task.wait(config.summerDelay)
    end
end

local function foodLoop()
    while activeLoops.food and config.farmFood do
        local zone = getZone("Zone12.1")
        local pets = getPets()
        if zone and zone:FindFirstChild("FoodSpawns") and #pets > 0 then
            local idx = 1
            for _, food in ipairs(zone.FoodSpawns:GetChildren()) do
                if not activeLoops.food then break end
                CollectionRF:InvokeServer("CollectFood", food, pets[idx])
                idx = idx % #pets + 1
            end
        end
        task.wait(config.foodDelay)
    end
end

-- Gerenciador de loops
local function startLoop(name, func)
    if activeLoops[name] then return end
    activeLoops[name] = true
    task.spawn(func)
end

local function stopLoop(name)
    activeLoops[name] = false
end

-- ========== INTERFACE RAYFIELD OTIMIZADA ==========
local Window = Rayfield:CreateWindow({
    Name = "Maverick Hub",
    LoadingTitle = "Otimizacao",
    LoadingSubtitle = "FPS Boost + Farms",
    ConfigurationSaving = { Enabled = true, FolderName = "MaverickHub", FileName = "Config" },
    Discord = { Enabled = false },
    KeySystem = false,
})

-- Aba Principal
local MainTab = Window:CreateTab("Principal", "home")
local MainSection = MainTab:CreateSection("Controle")

local StatusLabel = MainTab:CreateParagraph({
    Title = "Status",
    Content = "Parado | FPS Boost ATIVO | Anti-popup"
})

MainTab:CreateButton({
    Name = "Iniciar Todas Farms",
    Callback = function()
        config.autoPlant = true
        config.autoHash = true
        config.autoFeedNests = true
        config.farmBosses = true
        config.farmSummer = true
        config.farmFood = true

        if next(eggsSelected) == nil then
            Rayfield:Notify({Title = "Aviso", Content = "Nenhum ovo selecionado!", Duration = 3})
        end

        startLoop("plant", plantLoop)
        startLoop("hash", hashLoop)
        startLoop("feed", feedLoop)
        startLoop("boss", bossLoop)
        startLoop("summer", summerLoop)
        startLoop("food", foodLoop)

        StatusLabel:Set({Title = "Status", Content = "Executando | FPS Boost ATIVO"})
        Rayfield:Notify({Title = "Farm", Content = "Todas farms iniciadas", Duration = 3})
    end
})

MainTab:CreateButton({
    Name = "Parar Todas Farms",
    Callback = function()
        config.autoPlant = false
        config.autoHash = false
        config.autoFeedNests = false
        config.farmBosses = false
        config.farmSummer = false
        config.farmFood = false

        for k, _ in pairs(activeLoops) do stopLoop(k) end

        StatusLabel:Set({Title = "Status", Content = "Parado | FPS Boost ATIVO | Anti-popup"})
        Rayfield:Notify({Title = "Farm", Content = "Todas farms paradas", Duration = 3})
    end
})

MainSection = MainTab:CreateSection("Desempenho")
MainTab:CreateToggle({
    Name = "FPS Boost Extremo",
    CurrentValue = true,
    Callback = function(Value)
        applyFPSBoost(Value)
    end
})

MainTab:CreateParagraph({
    Title = "Otimizacoes",
    Content = "• Sombras desativadas\n• Qualidade minima\n• Particulas removidas\n• Console limpo a cada 5s"
})

-- Aba Ovos
local EggsTab = Window:CreateTab("Ovos", "package")
EggsTab:CreateSection("Selecao de Ovos")
for _, egg in ipairs(eggData) do
    EggsTab:CreateToggle({
        Name = egg.name,
        CurrentValue = false,
        Callback = function(Value)
            if Value then eggsSelected[egg.zone] = true else eggsSelected[egg.zone] = nil end
        end
    })
end

EggsTab:CreateSection("Config. Plantio")
EggsTab:CreateSlider({
    Name = "Quantidade por burst",
    Range = {1, 20},
    Increment = 1,
    Suffix = "x",
    CurrentValue = config.plantBurstCount,
    Callback = function(v) config.plantBurstCount = v end
})
EggsTab:CreateSlider({
    Name = "Delay entre bursts (s)",
    Range = {0, 0.5},
    Increment = 0.01,
    Suffix = "s",
    CurrentValue = config.plantBurstDelay,
    Callback = function(v) config.plantBurstDelay = v end
})

-- Aba Chefes
local BossesTab = Window:CreateTab("Chefes", "shield")
BossesTab:CreateToggle({
    Name = "Farmar Chefes",
    CurrentValue = false,
    Callback = function(Value)
        config.farmBosses = Value
        if Value then startLoop("boss", bossLoop) else stopLoop("boss") end
    end
})

BossesTab:CreateSection("Chefes Disponiveis")
for _, boss in ipairs(bossList) do
    BossesTab:CreateToggle({
        Name = boss.name,
        CurrentValue = false,
        Callback = function(v) bossEnabled[boss.name] = v end
    })
end

BossesTab:CreateSection("Configuracoes")
BossesTab:CreateSlider({
    Name = "Delay entre ataques (s)",
    Range = {0.1, 1},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = config.bossDelay,
    Callback = function(v) config.bossDelay = v end
})

-- Aba Farms
local FarmsTab = Window:CreateTab("Farms", "zap")
FarmsTab:CreateSection("Auto Hash")
FarmsTab:CreateToggle({
    Name = "Chocar Ovos (Hash)",
    CurrentValue = false,
    Callback = function(Value)
        config.autoHash = Value
        if Value then startLoop("hash", hashLoop) else stopLoop("hash") end
    end
})
FarmsTab:CreateSlider({
    Name = "Quantidade por ciclo",
    Range = {1, 10},
    Increment = 1,
    Suffix = "x",
    CurrentValue = config.hashCount,
    Callback = function(v) config.hashCount = v end
})
FarmsTab:CreateSlider({
    Name = "Delay entre acoes (s)",
    Range = {0.0001, 0.01},
    Increment = 0.0001,
    Suffix = "s",
    CurrentValue = config.hashDelay,
    Callback = function(v) config.hashDelay = v end
})

FarmsTab:CreateSection("Auto Alimentar Ninhos")
FarmsTab:CreateToggle({
    Name = "Alimentar Ninhos",
    CurrentValue = false,
    Callback = function(Value)
        config.autoFeedNests = Value
        if Value then startLoop("feed", feedLoop) else stopLoop("feed") end
    end
})
FarmsTab:CreateSlider({
    Name = "Delay entre ciclos (s)",
    Range = {0.1, 2},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = config.feedDelay,
    Callback = function(v) config.feedDelay = v end
})

FarmsTab:CreateSection("Farm de Verao")
FarmsTab:CreateToggle({
    Name = "Farmar Evento Verao",
    CurrentValue = false,
    Callback = function(Value)
        config.farmSummer = Value
        if Value then startLoop("summer", summerLoop) else stopLoop("summer") end
    end
})
FarmsTab:CreateSlider({
    Name = "Delay entre ataques (s)",
    Range = {0.001, 0.1},
    Increment = 0.001,
    Suffix = "s",
    CurrentValue = config.summerDelay,
    Callback = function(v) config.summerDelay = v end
})

FarmsTab:CreateSection("Farm de Comida")
FarmsTab:CreateToggle({
    Name = "Coletar Comida",
    CurrentValue = false,
    Callback = function(Value)
        config.farmFood = Value
        if Value then startLoop("food", foodLoop) else stopLoop("food") end
    end
})
FarmsTab:CreateSlider({
    Name = "Delay entre coletas (s)",
    Range = {0.1, 1},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = config.foodDelay,
    Callback = function(v) config.foodDelay = v end
})

-- Notificação final
Rayfield:Notify({
    Title = "Maverick Hub",
    Content = "Carregado! FPS Boost ja ativo.",
    Duration = 3
})
